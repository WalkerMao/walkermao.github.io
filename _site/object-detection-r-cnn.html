<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://kit.fontawesome.com/123ecac47c.js" crossorigin="anonymous"></script><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="shortcut icon" type="image/png" href="/assets/portfolio.png">
<title>Object Detection: R-CNN</title>
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Object Detection: R-CNN | Weikai’s blog.</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Object Detection: R-CNN" />
<meta name="author" content="Weikai Mao" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The contents in this post are excerpted from the paper “Rich feature hierarchies for accurate object detection and semantic segmentation” 1, with a little bit modification, as my notes for this great paper. Girshick, Ross, et al. “Rich feature hierarchies for accurate object detection and semantic segmentation.” Proceedings of the IEEE conference on computer vision and pattern recognition. 2014.APA &#8617;" />
<meta property="og:description" content="The contents in this post are excerpted from the paper “Rich feature hierarchies for accurate object detection and semantic segmentation” 1, with a little bit modification, as my notes for this great paper. Girshick, Ross, et al. “Rich feature hierarchies for accurate object detection and semantic segmentation.” Proceedings of the IEEE conference on computer vision and pattern recognition. 2014.APA &#8617;" />
<link rel="canonical" href="http://localhost:4000/object-detection-r-cnn.html" />
<meta property="og:url" content="http://localhost:4000/object-detection-r-cnn.html" />
<meta property="og:site_name" content="Weikai’s blog." />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-12-05T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Object Detection: R-CNN" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Weikai Mao"},"dateModified":"2021-12-05T00:00:00+08:00","datePublished":"2021-12-05T00:00:00+08:00","description":"The contents in this post are excerpted from the paper “Rich feature hierarchies for accurate object detection and semantic segmentation” 1, with a little bit modification, as my notes for this great paper. Girshick, Ross, et al. “Rich feature hierarchies for accurate object detection and semantic segmentation.” Proceedings of the IEEE conference on computer vision and pattern recognition. 2014.APA &#8617;","headline":"Object Detection: R-CNN","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/object-detection-r-cnn.html"},"url":"http://localhost:4000/object-detection-r-cnn.html"}</script>
<!-- End Jekyll SEO tag -->


<meta name="google-site-verification" content="wXp8C1QlYKCpKxfXyFfQXEv9l5fJvcOi53ofYmOcaSA" />
<meta name="msvalidate.01" content="97F0BB32D312B808156DE357EA8474D3" />
<meta name="yandex-verification" content="690106a82d8966ab" />

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[", "\\]"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno"
      }
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>    


  







</head>
  <body>
    <main class="container">
      <section class="about">
        <a href="/" class="iconlink"> 
          <h3> 
            <i class="fas fa-home"></i> HOME 
          </h3> 
        </a>
        <a href="/"> <img src="/assets/portfolio.png" alt="Weikai Mao"></a>
        <h2 id="title"> Weikai Mao </h2>
        <p style="font-size:90%" class="tagline">maoweikai123@outlook.com</p>
        
        <ul class="social"><a href="https://github.com/WalkerMao">
              <li>
                <i class="fab fa-github"></i>
              </li>
            </a><a href="https://www.linkedin.com/in/weikai-mao-000249124">
              <li>
                <i class="fab fa-linkedin"></i>
              </li>
            </a><a href="/wechat-qr-code.html">
              <li>
                <i class="fab fa-weixin"></i>
              </li>
            </a></ul><h3 style="color:gray; font-weight:normal"> Categories: </h3>
            <ul class="post-categories" style="max-width:225px;">
              
                  <a class="post-link" href="/"> <li style="padding: 4px 8px;"> All </li> </a>
              
                  <a class="post-link" href="/categories/cs"> <li style="padding: 4px 8px;"> CS </li> </a>
              
                  <a class="post-link" href="/categories/cv"> <li style="padding: 4px 8px;"> CV </li> </a>
              
                  <a class="post-link" href="/categories/dl"> <li style="padding: 4px 8px;"> DL </li> </a>
              
                  <a class="post-link" href="/categories/fe"> <li style="padding: 4px 8px;"> FE </li> </a>
              
                  <a class="post-link" href="/categories/math"> <li style="padding: 4px 8px;"> Math </li> </a>
              
                  <a class="post-link" href="/categories/ml"> <li style="padding: 4px 8px;"> ML </li> </a>
              
                  <a class="post-link" href="/categories/nlp"> <li style="padding: 4px 8px;"> NLP </li> </a>
              
                  <a class="post-link" href="/categories/stat"> <li style="padding: 4px 8px;"> Stat </li> </a>
              
                  <a class="post-link" href="/categories/杂"> <li style="padding: 4px 8px;"> 杂 </li> </a>
              
            </ul><p>&copy; 2023 </p>

      </section>
      <section class="content">
        <div class="sidebar">
  <ul><li><a href="#1-introduction">1. Introduction</a></li><li><a href="#2-object-detection-with-r-cnn">2. Object detection with R-CNN</a><ul><li><a href="#22-test-time-detection">2.2 Test-time detection</a></li><li><a href="#23-training">2.3 Training</a></li></ul></li><li><a href="#appendix">Appendix</a><ul><li><a href="#b-positive-vs-negative-examples-and-softmax">B. Positive vs. negative examples and softmax</a><ul><li><a href="#b1-positive-vs-negative-examples">B.1 Positive vs. negative examples</a></li><li><a href="#b2-svms-rather-than-softmax">B.2 SVMs rather than softmax</a></li></ul></li><li><a href="#c-bounding-box-regression">C. Bounding-box regression</a></li></ul></li></ul>

</div><div class="post-container" id="viewpoint">
  <a class="post-link" href="/object-detection-r-cnn.html">
    <h2 class="post-title">Object Detection: R-CNN</h2>
  </a>
  <div class="post-meta">
    <div>
      <ul class="post-categories"><a class="post-link" href="/categories/cv"> <li>CV</li> </a><a class="post-link" href="/categories/dl"> <li>DL</li> </a></ul>
      <ul class="post-tags"><a class="post-link" href="/tags/object detection"> <li>Object detection</li> </a><a class="post-link" href="/tags/cnn"> <li>CNN</li> </a></ul>
    </div>
    <div class="post-date">
      <i class="icon-calendar"></i>
      Dec 5, 2021
    </div>
  </div>
  <div style="line-height:77%;">
    <br>
  </div>
  <div class="post"><p>The contents in this post are excerpted from the paper “Rich feature hierarchies for accurate object detection and semantic segmentation” <sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>, with a little bit modification, as my notes for this great paper.</p>

<h2 id="1-introduction">1. Introduction</h2>

<p>This method solves the CNN localization problem by operating within the “recognition using regions” paradigm, as argued for by Gu et al. in “<a href="https://ieeexplore.ieee.org/abstract/document/5206727/">Recognition using regions</a>”. At test-time, this method consists of three modules:</p>

<ol>
  <li>generates around 2000 category-independent region proposals (by using <a href="https://link.springer.com/article/10.1007/s11263-013-0620-5">selective search</a> in experiment) for the input image;</li>
  <li>extracts a fixed-length (4096-dimensional in experiment) feature vector from each proposal using a CNN as a blackbox feature extractor;</li>
  <li>classifies each region with category-specific linear SVMs.</li>
</ol>

<p>This method use a simple technique (affine image warping) to compute a fixed-size CNN input from each region proposal, regardless of the region’s shape.</p>

<p>This method combines region proposals with CNNs, the authors dub it R-CNN: Regions with CNN features.</p>

<div align="center">
<figure>
<img src="https://www.researchgate.net/profile/Carlos-Ferrin/publication/330093035/figure/fig2/AS:740722319831046@1553613371577/R-CNN-Region-with-Convolutional-Neural-Networks-features-Architecture-Taken-from-9.png" alt="Figure 1: ." style="zoom:70%;" />
<figcaption style="font-size:80%;"> Figure 1: Object detection system overview. (1) takes an input image, (2) extracts around 2000 bottom-up regionproposals, (3) computes features for each proposal using a largeconvolutional neural network (CNN), and then (4) classifies each region using class-specific linear SVMs. (<a href="https://openaccess.thecvf.com/content_cvpr_2014/html/Girshick_Rich_Feature_Hierarchies_2014_CVPR_paper.html">Source</a>) </figcaption>
</figure>
</div>

<p>The authors demonstrate that a simple bounding-box regression method significantly reduces mislocalizations, which are the dominant error mode.</p>

<h2 id="2-object-detection-with-r-cnn">2. Object detection with R-CNN</h2>

<h3 id="22-test-time-detection">2.2 Test-time detection</h3>

<p>Given all scored regions in an image, we apply a greedy non-maximum suppression (for each class independently) that rejects a region if it has an intersection-over-union (IoU) overlap with a higher scoring selected region larger than a learned threshold.</p>

<p>The only class-specific computations are dot products between features and SVM weights and non-maximum suppression.</p>

<h3 id="23-training">2.3 Training</h3>

<p>Since the training data is too large to fit in memory, we adopt the standard hard negative mining method (<a href="https://www.reddit.com/r/computervision/comments/2ggc5l/comment/ckiuu9i/?utm_source=share&amp;utm_medium=web2x&amp;context=3">a simple explanation</a>).</p>

<h2 id="appendix">Appendix</h2>

<h3 id="b-positive-vs-negative-examples-and-softmax">B. Positive vs. negative examples and softmax</h3>

<h4 id="b1-positive-vs-negative-examples">B.1 Positive vs. negative examples</h4>

<p>Positive and negative examples (region proposals) are defined differently for fine-tuning the CNN versus training the object detection SVMs.</p>

<table>
  <thead>
    <tr>
      <th>Scenario</th>
      <th>IoU of Negative</th>
      <th>IoU of Positive</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Finetunning CNN</td>
      <td>\(&lt; 0.5\)</td>
      <td>\(\geq 0.5\) (many jittered examples to avoid overfitting)</td>
    </tr>
    <tr>
      <td>Training SVMs</td>
      <td>\(&lt; 0.3\)</td>
      <td>\(= 1\) (groundtruth)</td>
    </tr>
  </tbody>
</table>

<p>Here the IoU refers to the IoU between example (region proposal) and groundtruth.</p>

<p>The fine-tuning data is limited. This scheme introduces many “jittered” examples (those proposals with overlap between 0.5 and 1, but not ground truth), which expands the number of positive examples by approximately 30x. The authors conjecture that this helps avoid overfitting.</p>

<h4 id="b2-svms-rather-than-softmax">B.2 SVMs rather than softmax</h4>

<p>After fine-tunning, we train SVMs, rather than simply apply the last layer of the fine-tuned network, which is a 21-way soft-max regression classifier, as the object detector. The authors found that performance on VOC 2007 dropped from 54.2% (SVMs) to 50.9% (softmax) mAP. This performance drop likely arises from a combination of several factors including that the definition of positive examples used in fine-tuning does not emphasize precise localization and the softmax classifier was trained on randomly sampled negative examples rather than on the subset of “hard negatives” used for SVM training.</p>

<p>My understanding: SVMs are suitable for small sample-size, and strict positive/negative samples are enough to train SVMs. In contrast, training CNN needs large sample size, and the jittered examples help avoid overfitting.</p>

<h3 id="c-bounding-box-regression">C. Bounding-box regression</h3>

<p>After scoring each selective search proposal with a class-specific detection SVM, we predict a new bounding box for the detection using a class-specific bounding-box regressor to improve localization performance.  Our goal is to learn a transformation that maps a proposed box \(P=(P_x, P_y, P_w, P_h)\) to a groundtruth box \(P=(G_x, G_y, G_w, G_h)\). We  parameterize the transformation in terms of four functions \(\{d_{\star}(P)=\mathbf{w}_{\star}^{\mathrm{T}} \boldsymbol{\phi}_{5}(P)\}_{\star=x,y,h,w}\).</p>

<p>Two subtle issues while implementing bounding-box regression:</p>

<ol>
  <li>Regularization is important.</li>
  <li>We select training pairs \((P, Q)\) such that \(\text{IoU}(P, Q) &gt; 0.6\). If more than one \(Q\) satisfy this requirement, we select the \(Q\) with the largest IoU.</li>
</ol>

<p><br /></p>

<p><strong>Reference:</strong></p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Girshick, Ross, et al. “Rich feature hierarchies for accurate object detection and semantic segmentation.” <em>Proceedings of the IEEE conference on computer vision and pattern recognition</em>. 2014.APA <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div>

  <br> </br>
  <p><font color="grey" size="4"> Comments </font></p>
  <HR color=#D1D0CE SIZE=10>

<div id="disqus_thread"></div>

<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://walkermao.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


                            

  
</div>

      </section>
    </main><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-178951885-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-178951885-1');
</script>

    
    <div id="back-top">
      <a href="javascript:void(0);" onclick="topFunction()" title="Back to top"> </a>
    </div>

  </body>
</html>

<script src = "/assets/js/scroll_into_view.js"></script>
<script src = "/assets/js/back_to_top.js"></script>